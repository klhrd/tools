<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v1.2.0 - 文字編碼色塊矩陣工具</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js" defer></script>
</head>
<body>
    <div id="app-container">
        <h1>文字編碼色塊矩陣工具 <small>v1.2.0</small></h1>
        
        <div class="menu-header">
            <label for="function-selector">選擇功能：</label>
            <select id="function-selector">
                <option value="tab-encoder">編碼器 (生成圖片)</option>
                <option value="tab-decoder">解碼器 (圖片轉文字)</option>
                <option value="tab-reader">測字儀 (像素轉文字)</option>
            </select>
        </div>

        <div id="content-area">
            
            <div id="tab-encoder" class="tab-content active">
                <section id="config-panel" class="panel">
                    <h2>1. 輸入與配置</h2>
                    
                    <label for="text-input">文字訊息 (支援多行與 Emoji)：</label>
                    <textarea id="text-input" rows="5">歡迎使用 v1.2.0！
長文字自動換行已優化。</textarea>
                    
                    <div id="controls-grid">
                        <label for="block-width">區塊寬度 (px):</label>
                        <input type="number" id="block-width" value="25" min="5">

                        <label for="block-height">區塊高度 (px):</label>
                        <input type="number" id="block-height" value="40" min="5">

                        <button id="generate-button" class="btn-primary">生成色塊矩陣</button>
                    </div>
                </section>

                <section id="output-panel" class="panel">
                    <h2>輸出結果</h2>
                    <div class="canvas-wrapper">
                        <canvas id="color-canvas"></canvas>
                    </div>
                    <div id="tooltip"></div>
                    
                    <div id="export-panel">
                        <button id="export-png-button" class="btn-secondary">📥 匯出 PNG</button>
                        <button id="export-pdf-button" class="btn-secondary">📄 匯出 PDF</button>
                    </div>
                </section>
            </div>

            <div id="tab-decoder" class="tab-content">
                <section id="decoder-panel" class="panel">
                    <h2>2. 解碼器：圖片 ➔ 文字</h2>
                    <p>將完整的色塊矩陣圖片還原成文字。</p>

                    <input type="file" id="image-upload" accept="image/png">
                    <button id="decode-button" class="btn-primary" disabled>開始解碼</button>

                    <h3>解碼結果：</h3>
                    <div id="decoded-output" class="result-box">
                        請上傳圖片。
                    </div>
                    <canvas id="decode-canvas" style="display:none;"></canvas>
                </section>
            </div>
            
            <div id="tab-reader" class="tab-content">
                <section id="reader-panel" class="panel">
                    <h2>3. 測字儀：像素轉譯</h2>
                    <p>點擊或移動滑鼠，讀取圖片上單一像素的編碼。</p>

                    <div class="reader-controls">
                        <label>圖片來源：</label>
                        <input type="file" id="reader-image-upload" accept="image/*">
                        <button id="reader-webcam-button" class="btn-secondary" style="margin-left: 10px;">🎥 啟動攝影機 (僅 HTTPS)</button>
                        <p id="webcam-status" class="warning-text"></p>
                    </div>
                    
                    <div class="reader-display">
                        <video id="reader-video" autoplay style="display: none;"></video>
                        <canvas id="reader-canvas" class="reader-view"></canvas>
                        <div id="crosshair"></div> </div>

                    <h3>即時轉譯結果：</h3>
                    <div id="reader-output" class="result-box">
                        將準心移到色塊上...
                    </div>
                    
                    <canvas id="webcam-capture-canvas" style="display:none;"></canvas>
                </section>
            </div>
        </div>
    </div>
</body>
</html>
