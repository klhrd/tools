<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和弦翻譯機 - 美化升級版 v1.5.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', 'Segoe UI', sans-serif;
            background: linear-gradient(120deg, #f8fafc 0%, #e0e7ff 100%);
        }
        #menu-toggle { display: none; }
        #menu-toggle:checked ~ #menu-sidebar { transform: translateX(0);}
        .focus-ring:focus {
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-shadow);
        }
        #menu-sidebar { backdrop-filter: blur(6px); border-right: 1px solid #e0e7ef;}
        .menu-btn {
            transition: box-shadow 0.2s;
            box-shadow: 0 1px 8px 0 rgb(72 99 255 / 8%);
        }
        .menu-btn:hover {
            box-shadow: 0 4px 12px 0 rgb(72 99 255 / 12%);
            background: linear-gradient(90deg, #f1f5ff 0%, #dbeafe 100%);
        }
        /* 音程表滾動條美化 */
        .nice-scroll::-webkit-scrollbar {
            height: 8px;
            background: #e0e7ff;
        }
        .nice-scroll::-webkit-scrollbar-thumb {
            background: #b4c7ff;
            border-radius: 6px;
        }
    </style>
</head>
<body class="p-0 sm:p-8">

<input type="checkbox" id="menu-toggle" class="hidden">
<div id="menu-sidebar" class="fixed top-0 left-0 w-72 h-full bg-white/95 shadow-2xl z-30 transform -translate-x-full transition-transform duration-300 ease-in-out p-7 flex flex-col gap-6 border-r border-indigo-100">
    <label for="menu-toggle" class="absolute top-5 right-5 text-3xl cursor-pointer text-gray-400 hover:text-red-500 transition-colors">&times;</label>
    <h2 class="text-2xl font-bold text-indigo-700 border-b pb-3 mb-3 tracking-wide flex gap-2 items-center">
        <span class="text-indigo-400">🎹</span> 和弦工具箱
    </h2>
    <button onclick="showManual();" class="menu-btn w-full py-3 px-4 rounded-xl text-gray-700 hover:bg-indigo-50 text-lg font-medium flex items-center gap-2 transition">
        <span class="mr-1">📖</span> 顯示說明書
    </button>
    <button onclick="showIntervalTable();" class="menu-btn w-full py-3 px-4 rounded-xl text-gray-700 hover:bg-indigo-50 text-lg font-medium flex items-center gap-2 transition">
        <span class="mr-1">🎼</span> 顯示音程表
    </button>
</div>

<div class="relative max-w-xl mx-auto bg-white/95 p-6 sm:p-8 rounded-none sm:rounded-2xl shadow-none sm:shadow-2xl border-none sm:border border-indigo-100 min-h-screen sm:min-h-0">
    <label for="menu-toggle" class="absolute top-5 left-5 text-3xl cursor-pointer text-indigo-400 hover:text-indigo-600 transition-colors sm:top-8 sm:left-8 z-20">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </label>
    <h1 class="text-4xl font-extrabold text-center text-indigo-700 mt-2 sm:mt-0 pt-12 sm:pt-2 tracking-wide drop-shadow mb-1">🎵 和弦翻譯機</h1>
    <p class="text-center text-gray-500 mb-6 text-base">支援常見三和弦到十三和弦。<span class="text-indigo-400 font-semibold text-xs ml-2">v1.5.1</span></p>
    <div class="flex flex-col sm:flex-row gap-3 mb-6">
        <input type="text" id="chordInput" placeholder="輸入和弦名稱，如：C13, F#m11, Ebm7b5" 
               class="flex-grow p-3 border border-indigo-200 rounded-xl text-lg focus-ring focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition shadow-sm" 
               onkeyup="if(event.key === 'Enter') translateChord()">
        <button onclick="translateChord()" 
                class="w-full sm:w-auto px-7 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:from-indigo-600 hover:to-indigo-700 transition transform hover:scale-[1.04]">
            解 析
        </button>
    </div>
    <div id="result" class="mt-8 p-5 bg-white border border-indigo-100 rounded-xl text-gray-800 shadow-md transition duration-300">
        <p class="text-center text-lg text-gray-500">輸入和弦名稱後，結果將顯示在這裡。</p>
    </div>
</div>

<!-- 說明書 Modal -->
<div id="manual-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-40" onclick="hideManual(event)">
    <div class="bg-white rounded-2xl shadow-2xl max-w-xl w-full p-7 max-h-[80vh] overflow-y-auto relative" onclick="event.stopPropagation()">
        <h2 class="text-3xl font-bold text-indigo-700 mb-5 border-b pb-3 flex gap-2 items-center">
            <span>📖</span> 使用說明書
        </h2>
        <div class="text-gray-700 space-y-4 text-base leading-relaxed">
            <p><strong>歡迎使用和弦翻譯機！</strong> 這個工具能幫您快速查詢各種和弦的組成音及樂理定義，無論是初學者或進階玩家都適用。</p>
            <h3 class="font-semibold text-lg text-red-600">📌 如何輸入和弦？</h3>
            <p>請依循「<b>根音 + 和弦品質</b>」的格式輸入：</p>
            <ul class="list-disc list-inside ml-4 space-y-1">
                <li><b>根音:</b> 使用標準字母 <span class="font-mono text-indigo-600">A</span> 到 <span class="font-mono text-indigo-600">G</span>，升記號用 <span class="font-mono text-indigo-600">#</span> (如 <span class="font-mono">F#</span>)，降記號用 <span class="font-mono text-indigo-600">b</span> (如 <span class="font-mono">Eb</span>)。</li>
                <li><b>品質:</b> 例如：<span class="font-mono">m</span> (小調), <span class="font-mono">maj7</span>, <span class="font-mono">m7</span>, <span class="font-mono">dim</span>, <span class="font-mono">aug</span>, <span class="font-mono">sus4</span>, <span class="font-mono">add9</span> 等。</li>
            </ul>
            <h3 class="font-semibold text-lg text-red-600">🛠 支援的類型範例：</h3>
            <table class="min-w-full divide-y divide-gray-200 border border-indigo-100 rounded-lg shadow-sm text-sm">
                <thead class="bg-indigo-50">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">類型</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">範例</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">音程數</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-indigo-50">
                    <tr><td class="px-3 py-2 whitespace-nowrap">三和弦</td><td>C, F#m, Cdim, Gaug</td><td>3</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">七和弦</td><td>A7, Bbmaj7, Dm7b5, Edim7</td><td>4</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">延伸和弦</td><td>C9, Gm11, Emaj13</td><td>5-7</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">變化和弦</td><td>D7b9, C#11, Fmaj#11</td><td>4-6</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">掛留/加音</td><td>Csus4, Asus2, Gadd9</td><td>3-4</td></tr>
                </tbody>
            </table>
        </div>
        <p class="mt-6 text-xs text-gray-400 text-right border-t pt-3">
            2025-10-12 04:12:43 v1.5.1
        </p>
        <button onclick="hideManual()" class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-5/6 py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-bold rounded-xl hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition mt-2">
            關閉說明
        </button>
    </div>
</div>

<!-- 音程表 Modal -->
<div id="interval-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-40" onclick="hideIntervalTable(event)">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-7 max-h-[80vh] overflow-x-auto nice-scroll relative" onclick="event.stopPropagation()">
        <h2 class="text-3xl font-bold text-indigo-700 mb-5 border-b pb-3 flex gap-2 items-center">
            <span>🎼</span> 全音域音程對照表
        </h2>
        <div id="interval-table" class="my-2"></div>
        <button onclick="hideIntervalTable()" class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-5/6 py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-bold rounded-xl hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition mt-2">
            關閉音程表
        </button>
    </div>
</div>

<script>
    // -------------------------------------------------------------------
    // --- 核心音樂數據 (與 V3 相同，已包含豐富的和弦類型) ---
    // -------------------------------------------------------------------
    const NOTES_FOR_PARSING = [
        "C#", "Db", "D#", "Eb", "F#", "Gb", "G#", "Ab", "A#", "Bb", 
        "C", "D", "E", "F", "G", "A", "B"
    ];
    const PITCHES = {
        "C": 0, "C#": 1, "Db": 1, "D": 2, "D#": 3, "Eb": 3, 
        "E": 4, "F": 5, "F#": 6, "Gb": 6, "G": 7, "G#": 8, 
        "Ab": 8, "A": 9, "A#": 10, "Bb": 10, "B": 11
    };
    const OUTPUT_NOTES = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
    const INTERVAL_NAMES = {
        0: "根音 (R)", 1: "小二度 (b2)", 2: "大二度 (M2)", 3: "小三度 (m3)", 4: "大三度 (M3)", 
        5: "完全四度 (P4)", 6: "減五度 (b5)/增四度 (#4)", 7: "完全五度 (P5)", 8: "增五度 (#5)", 
        9: "大六度 (M6)", 10: "小七度 (m7)", 11: "大七度 (M7)", 12: "八度 (8)",
        14: "大九度 (M9)", 15: "小十度 (m10)", 17: "完全十一度 (P11)", 18: "增十一度 (#11)", 
        21: "大十三度 (M13)"
    };
    const CHORDS = {
        "":        ["大三和弦", [4, 7], "由根音、大三度、完全五度構成。明亮、穩定。"],
        "m":       ["小三和弦", [3, 7], "由根音、小三度、完全五度構成。柔和、憂鬱。"],
        "dim":     ["減三和弦", [3, 6], "由根音、小三度、減五度構成。極度不穩定。"],
        "aug":     ["增三和弦", [4, 8], "由根音、大三度、增五度構成。不穩定、有擴張感。"],
        "sus4":    ["掛留四和弦", [5, 7], "四度取代三度。不穩定，傾向解決到大三或小三和弦。"],
        "sus2":    ["掛留二和弦", [2, 7], "二度取代三度。清新、開放的音響。"],
        "add9":    ["加九和弦", [4, 7, 14], "大三和弦加上大九度（沒有七度音）。比單純大三更柔和。"],
        "madd9":   ["小調加九和弦", [3, 7, 14], "小三和弦加上大九度（沒有七度音）。"],
        "7":       ["屬七和弦", [4, 7, 10], "大三和弦加上小七度。具有強烈傾向解決的屬功能。"],
        "maj7":    ["大七和弦", [4, 7, 11], "大三和弦加上大七度。柔和、寬廣、帶有爵士色彩。"],
        "m7":      ["小七和弦", [3, 7, 10], "小三和弦加上小七度。內斂、豐富、常用於爵士和流行。"],
        "mmaj7":   ["小大七和弦", [3, 7, 11], "小三和弦加上大七度。色彩獨特，常營造神秘或緊張感。"],
        "m7b5":    ["半減七和弦", [3, 6, 10], "由減三和弦加上小七度構成。常作為小調的二級和弦。"],
        "dim7":    ["減七和弦", [3, 6, 9], "由減三和弦加上減七度（雙降七度）。高度對稱，極不穩定，常作轉調用。"],
        "7#5":     ["增屬七和弦", [4, 8, 10], "屬七和弦的五度音升高半音。"],
        "7b5":     ["減五屬七和弦", [4, 6, 10], "屬七和弦的五度音降低半音。"],
        "7#9":     ["屬七升九和弦", [4, 7, 10, 15], "屬七和弦加上增九度 (小三度)。強烈的屬功能。"],
        "7b9":     ["屬七降九和弦", [4, 7, 10, 13], "屬七和弦加上小九度。強烈的解決趨勢。"],
        "9":       ["屬九和弦", [4, 7, 10, 14], "屬七和弦加上大九度。飽滿、爵士味濃厚。"],
        "m9":      ["小九和弦", [3, 7, 10, 14], "小七和弦加上大九度。深沉、豐富、常營造冷靜氛圍。"],
        "maj9":    ["大九和弦", [4, 7, 11, 14], "大七和弦加上大九度。極其柔和、高雅的爵士色彩。"],
        "11":      ["屬十一和弦", [4, 7, 10, 14, 17], "屬九和弦加上完全十一度。通常省略三度音。"],
        "m11":     ["小十一和弦", [3, 7, 10, 14, 17], "小九和弦加上完全十一度。常用於爵士樂的二級和弦。"],
        "maj11":   ["大十一和弦", [4, 7, 11, 14, 17], "大九和弦加上完全十一度。較少見。"],
        "#11":     ["屬七升十一和弦", [4, 7, 10, 14, 18], "屬九和弦加上增十一度。帶有Lydian色彩。"],
        "maj#11":  ["大七升十一和弦", [4, 7, 11, 14, 18], "大九和弦加上增十一度。典型的Lydian和弦，明亮而夢幻。"],
        "13":      ["屬十三和弦", [4, 7, 10, 14, 17, 21], "屬十一和弦加上大十三度。最豐滿的屬功能和弦。"],
        "m13":     ["小十三和弦", [3, 7, 10, 14, 17, 21], "小十一和弦加上大十三度。溫暖而深邃的爵士色彩。"],
        "maj13":   ["大十三和弦", [4, 7, 11, 14, 17, 21], "大十一和弦加上大十三度。極其豐富、平靜的和弦。"],
    };

    function getNoteName(index) { return OUTPUT_NOTES[index % 12]; }
    
    function getChordTonesAndIntervals(rootName, intervals) {
        const rootIndex = PITCHES[rootName];
        if (rootIndex === undefined) return { tones: [], intervals: [] };

        const tones = [rootName];
        const intervalNames = [INTERVAL_NAMES[0]];

        for (const interval of intervals) {
            const toneIndex = (rootIndex + interval) % 12;
            const noteName = getNoteName(toneIndex);
            
            tones.push(noteName);
            intervalNames.push(INTERVAL_NAMES[interval] || `未知 (${interval} 半音)`);
        }
        return { tones, intervals: intervalNames };
    }

    function parseChordInput(input) {
        const upperInput = input.toUpperCase().replace(/\s/g, '');

        for (const note of NOTES_FOR_PARSING) {
            if (upperInput.startsWith(note)) {
                const rootName = note;
                let quality = upperInput.substring(note.length).toLowerCase();
                
                quality = quality.replace(/\(maj7\)/, 'maj7');
                quality = quality.replace(/(-5|\(b5\))/, 'b5');
                if (quality.startsWith('add')) quality = 'add' + quality.substring(3);
                if (quality.startsWith('sus')) quality = 'sus' + quality.substring(3);
                
                if (quality === "#5") quality = "aug"; 
                if (quality === "b5") quality = "dim"; 

                return { rootName, quality };
            }
        }
        return null;
    }

    function translateChord() {
        const input = document.getElementById('chordInput').value.trim();
        const resultDiv = document.getElementById('result');
        resultDiv.className = "mt-8 p-5 bg-white border border-indigo-100 rounded-xl text-gray-800 shadow-md transition duration-300";

        if (!input) {
            resultDiv.innerHTML = "<p class='text-center text-lg text-gray-500'>請輸入一個有效的和弦名稱！</p>";
            return;
        }

        let parsed = parseChordInput(input);
        
        if (!parsed) {
             const singleRoot = input.toUpperCase();
             if (PITCHES.hasOwnProperty(singleRoot) && singleRoot.length <= 2) {
                 parsed = { rootName: singleRoot, quality: "" };
             } else {
                 resultDiv.innerHTML = `<p class='text-center text-lg text-red-500 font-semibold'>無法識別的根音：<strong>${input}</strong></p><p class='text-center text-gray-500'>請使用標準音名 C, D, Eb, F#, Bb, 等。</p>`;
                 return;
             }
        }
        
        const { rootName, quality } = parsed;
        const chordInfo = CHORDS[quality];

        if (!chordInfo) {
            resultDiv.innerHTML = `<p class='text-center text-lg text-red-500 font-semibold'>無法識別的和弦類型：<strong>${quality || "（大三和弦除外）"}</strong></p><p class='text-center text-gray-500'>請確認輸入的和弦記號是否標準。</p>`;
            return;
        }

        const [chordName, intervals, definition] = chordInfo;
        const { tones, intervals: intervalNames } = getChordTonesAndIntervals(rootName, intervals);
        
        if (tones.length === 0) {
             resultDiv.innerHTML = `<p class='text-center text-lg text-red-500'>內部錯誤：無法計算和弦音。</p>`;
             return;
        }

        let output = `
<div class="space-y-6">
    <p class="text-2xl font-extrabold text-indigo-700 text-center tracking-wide">
        ${rootName}${quality} 
        <span class="block text-base font-medium text-gray-500 mt-1">(${rootName}${chordName})</span>
    </p>
    <div class="bg-gradient-to-r from-indigo-50 via-white to-indigo-100 p-4 rounded-xl border border-indigo-50 shadow">
        <p class="text-xl font-bold text-gray-800 mb-2 border-b border-indigo-100 pb-1">🎵 組成音:</p>
        <p class="text-4xl font-mono tracking-wider text-red-600 text-center">${tones.join(' - ')}</p>
    </div>
    <div class="p-4 rounded-xl border border-indigo-100 bg-white shadow">
        <p class="text-xl font-bold text-gray-800 mb-3 border-b border-indigo-100 pb-1">🎶 音程關係:</p>
        <div class="grid grid-cols-2 gap-3 text-sm sm:text-base">
            ${tones.map((tone, index) => 
                `<p class="flex items-center"><span class="font-mono bg-indigo-100 text-indigo-700 px-2 py-1 rounded mr-2 w-12 text-center">${tone}</span> <span class="text-gray-600">${intervalNames[index]}</span></p>`
            ).join('')}
        </div>
    </div>
    <p class="text-base pt-2 border-t border-indigo-100">
        <span class="font-bold text-indigo-700">✨ 定義與特性：</span> ${definition}
    </p>
</div>
        `;
        resultDiv.innerHTML = output;
    }

    // --- 說明書功能 ---
    function showManual() {
        document.getElementById('menu-toggle').checked = false; 
        document.getElementById('manual-modal').classList.remove('hidden');
        document.getElementById('manual-modal').classList.add('flex');
    }
    function hideManual(event) {
        if (event && event.target.id !== 'manual-modal') return; 
        document.getElementById('manual-modal').classList.remove('flex');
        document.getElementById('manual-modal').classList.add('hidden');
    }
    // --- 音程表功能 ---
    function showIntervalTable() {
        document.getElementById('menu-toggle').checked = false;
        document.getElementById('interval-modal').classList.remove('hidden');
        document.getElementById('interval-modal').classList.add('flex');
        renderIntervalTable();
    }
    function hideIntervalTable(event) {
        if (event && event.target.id !== 'interval-modal') return;
        document.getElementById('interval-modal').classList.remove('flex');
        document.getElementById('interval-modal').classList.add('hidden');
    }

    // 音程表資料（CSV格式改為 JS 陣列）
    const intervalTableCSV = `根音 (Root),P1 (0),m2 (1),M2 (2),m3 (3),M3 (4),P4 (5),A4/d5 (6),P5 (7),A5/m6 (8),M6 (9),m7 (10),M7 (11),P8 (12)
C,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C
C#/D♭,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭
D,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D
D#/E♭,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭
E,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E
F,F,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F
F#/G♭,F#/G♭,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭
G,G,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G
G#/A♭,G#/A♭,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭
A,A,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A
A#/B♭,A#/B♭,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭
B,B,C,C#/D♭,D,D#/E♭,E,F,F#/G♭,G,G#/A♭,A,A#/B♭,B`;

    function renderIntervalTable() {
        const rows = intervalTableCSV.trim().split('\n').map(r => r.split(','));
        let html = '<div class="overflow-x-auto"><table class="min-w-full border border-indigo-100 rounded-xl text-center text-sm shadow-sm bg-white">';
        html += '<thead class="bg-indigo-50">';
        html += '<tr>' + rows[0].map(cell => `<th class="px-3 py-2 font-bold text-indigo-700">${cell}</th>`).join('') + '</tr></thead>';
        html += '<tbody>';
        for(let i=1;i<rows.length;i++) {
            html += '<tr>' + rows[i].map(cell => `<td class="px-2 py-1 border-t border-indigo-50 font-mono">${cell}</td>`).join('') + '</tr>';
        }
        html += '</tbody></table></div>';
        document.getElementById('interval-table').innerHTML = html;
    }

    // Esc 關閉 Modal
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.getElementById('manual-modal').classList.remove('flex');
            document.getElementById('manual-modal').classList.add('hidden');
            document.getElementById('interval-modal').classList.remove('flex');
            document.getElementById('interval-modal').classList.add('hidden');
            document.getElementById('menu-toggle').checked = false;
        }
    });
</script>

</body>
</html>