<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å’Œå¼¦ç¿»è­¯æ©Ÿ - ç¾åŒ–å‡ç´šç‰ˆ v1.5.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', 'Segoe UI', sans-serif;
            background: linear-gradient(120deg, #f8fafc 0%, #e0e7ff 100%);
        }
        #menu-toggle { display: none; }
        #menu-toggle:checked ~ #menu-sidebar { transform: translateX(0);}
        .focus-ring:focus {
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-shadow);
        }
        #menu-sidebar { backdrop-filter: blur(6px); border-right: 1px solid #e0e7ef;}
        .menu-btn {
            transition: box-shadow 0.2s;
            box-shadow: 0 1px 8px 0 rgb(72 99 255 / 8%);
        }
        .menu-btn:hover {
            box-shadow: 0 4px 12px 0 rgb(72 99 255 / 12%);
            background: linear-gradient(90deg, #f1f5ff 0%, #dbeafe 100%);
        }
        /* éŸ³ç¨‹è¡¨æ»¾å‹•æ¢ç¾åŒ– */
        .nice-scroll::-webkit-scrollbar {
            height: 8px;
            background: #e0e7ff;
        }
        .nice-scroll::-webkit-scrollbar-thumb {
            background: #b4c7ff;
            border-radius: 6px;
        }
    </style>
</head>
<body class="p-0 sm:p-8">

<input type="checkbox" id="menu-toggle" class="hidden">
<div id="menu-sidebar" class="fixed top-0 left-0 w-72 h-full bg-white/95 shadow-2xl z-30 transform -translate-x-full transition-transform duration-300 ease-in-out p-7 flex flex-col gap-6 border-r border-indigo-100">
    <label for="menu-toggle" class="absolute top-5 right-5 text-3xl cursor-pointer text-gray-400 hover:text-red-500 transition-colors">&times;</label>
    <h2 class="text-2xl font-bold text-indigo-700 border-b pb-3 mb-3 tracking-wide flex gap-2 items-center">
        <span class="text-indigo-400">ğŸ¹</span> å’Œå¼¦å·¥å…·ç®±
    </h2>
    <button onclick="showManual();" class="menu-btn w-full py-3 px-4 rounded-xl text-gray-700 hover:bg-indigo-50 text-lg font-medium flex items-center gap-2 transition">
        <span class="mr-1">ğŸ“–</span> é¡¯ç¤ºèªªæ˜æ›¸
    </button>
    <button onclick="showIntervalTable();" class="menu-btn w-full py-3 px-4 rounded-xl text-gray-700 hover:bg-indigo-50 text-lg font-medium flex items-center gap-2 transition">
        <span class="mr-1">ğŸ¼</span> é¡¯ç¤ºéŸ³ç¨‹è¡¨
    </button>
</div>

<div class="relative max-w-xl mx-auto bg-white/95 p-6 sm:p-8 rounded-none sm:rounded-2xl shadow-none sm:shadow-2xl border-none sm:border border-indigo-100 min-h-screen sm:min-h-0">
    <label for="menu-toggle" class="absolute top-5 left-5 text-3xl cursor-pointer text-indigo-400 hover:text-indigo-600 transition-colors sm:top-8 sm:left-8 z-20">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </label>
    <h1 class="text-4xl font-extrabold text-center text-indigo-700 mt-2 sm:mt-0 pt-12 sm:pt-2 tracking-wide drop-shadow mb-1">ğŸµ å’Œå¼¦ç¿»è­¯æ©Ÿ</h1>
    <p class="text-center text-gray-500 mb-6 text-base">æ”¯æ´å¸¸è¦‹ä¸‰å’Œå¼¦åˆ°åä¸‰å’Œå¼¦ã€‚<span class="text-indigo-400 font-semibold text-xs ml-2">v1.5.1</span></p>
    <div class="flex flex-col sm:flex-row gap-3 mb-6">
        <input type="text" id="chordInput" placeholder="è¼¸å…¥å’Œå¼¦åç¨±ï¼Œå¦‚ï¼šC13, F#m11, Ebm7b5" 
               class="flex-grow p-3 border border-indigo-200 rounded-xl text-lg focus-ring focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition shadow-sm" 
               onkeyup="if(event.key === 'Enter') translateChord()">
        <button onclick="translateChord()" 
                class="w-full sm:w-auto px-7 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:from-indigo-600 hover:to-indigo-700 transition transform hover:scale-[1.04]">
            è§£ æ
        </button>
    </div>
    <div id="result" class="mt-8 p-5 bg-white border border-indigo-100 rounded-xl text-gray-800 shadow-md transition duration-300">
        <p class="text-center text-lg text-gray-500">è¼¸å…¥å’Œå¼¦åç¨±å¾Œï¼Œçµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡ã€‚</p>
    </div>
</div>

<!-- èªªæ˜æ›¸ Modal -->
<div id="manual-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-40" onclick="hideManual(event)">
    <div class="bg-white rounded-2xl shadow-2xl max-w-xl w-full p-7 max-h-[80vh] overflow-y-auto relative" onclick="event.stopPropagation()">
        <h2 class="text-3xl font-bold text-indigo-700 mb-5 border-b pb-3 flex gap-2 items-center">
            <span>ğŸ“–</span> ä½¿ç”¨èªªæ˜æ›¸
        </h2>
        <div class="text-gray-700 space-y-4 text-base leading-relaxed">
            <p><strong>æ­¡è¿ä½¿ç”¨å’Œå¼¦ç¿»è­¯æ©Ÿï¼</strong> é€™å€‹å·¥å…·èƒ½å¹«æ‚¨å¿«é€ŸæŸ¥è©¢å„ç¨®å’Œå¼¦çš„çµ„æˆéŸ³åŠæ¨‚ç†å®šç¾©ï¼Œç„¡è«–æ˜¯åˆå­¸è€…æˆ–é€²éšç©å®¶éƒ½é©ç”¨ã€‚</p>
            <h3 class="font-semibold text-lg text-red-600">ğŸ“Œ å¦‚ä½•è¼¸å…¥å’Œå¼¦ï¼Ÿ</h3>
            <p>è«‹ä¾å¾ªã€Œ<b>æ ¹éŸ³ + å’Œå¼¦å“è³ª</b>ã€çš„æ ¼å¼è¼¸å…¥ï¼š</p>
            <ul class="list-disc list-inside ml-4 space-y-1">
                <li><b>æ ¹éŸ³:</b> ä½¿ç”¨æ¨™æº–å­—æ¯ <span class="font-mono text-indigo-600">A</span> åˆ° <span class="font-mono text-indigo-600">G</span>ï¼Œå‡è¨˜è™Ÿç”¨ <span class="font-mono text-indigo-600">#</span> (å¦‚ <span class="font-mono">F#</span>)ï¼Œé™è¨˜è™Ÿç”¨ <span class="font-mono text-indigo-600">b</span> (å¦‚ <span class="font-mono">Eb</span>)ã€‚</li>
                <li><b>å“è³ª:</b> ä¾‹å¦‚ï¼š<span class="font-mono">m</span> (å°èª¿), <span class="font-mono">maj7</span>, <span class="font-mono">m7</span>, <span class="font-mono">dim</span>, <span class="font-mono">aug</span>, <span class="font-mono">sus4</span>, <span class="font-mono">add9</span> ç­‰ã€‚</li>
            </ul>
            <h3 class="font-semibold text-lg text-red-600">ğŸ›  æ”¯æ´çš„é¡å‹ç¯„ä¾‹ï¼š</h3>
            <table class="min-w-full divide-y divide-gray-200 border border-indigo-100 rounded-lg shadow-sm text-sm">
                <thead class="bg-indigo-50">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">é¡å‹</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">ç¯„ä¾‹</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">éŸ³ç¨‹æ•¸</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-indigo-50">
                    <tr><td class="px-3 py-2 whitespace-nowrap">ä¸‰å’Œå¼¦</td><td>C, F#m, Cdim, Gaug</td><td>3</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">ä¸ƒå’Œå¼¦</td><td>A7, Bbmaj7, Dm7b5, Edim7</td><td>4</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">å»¶ä¼¸å’Œå¼¦</td><td>C9, Gm11, Emaj13</td><td>5-7</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">è®ŠåŒ–å’Œå¼¦</td><td>D7b9, C#11, Fmaj#11</td><td>4-6</td></tr>
                    <tr><td class="px-3 py-2 whitespace-nowrap">æ›ç•™/åŠ éŸ³</td><td>Csus4, Asus2, Gadd9</td><td>3-4</td></tr>
                </tbody>
            </table>
        </div>
        <p class="mt-6 text-xs text-gray-400 text-right border-t pt-3">
            2025-10-12 04:12:43 v1.5.1
        </p>
        <button onclick="hideManual()" class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-5/6 py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-bold rounded-xl hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition mt-2">
            é—œé–‰èªªæ˜
        </button>
    </div>
</div>

<!-- éŸ³ç¨‹è¡¨ Modal -->
<div id="interval-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-40" onclick="hideIntervalTable(event)">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-7 max-h-[80vh] overflow-x-auto nice-scroll relative" onclick="event.stopPropagation()">
        <h2 class="text-3xl font-bold text-indigo-700 mb-5 border-b pb-3 flex gap-2 items-center">
            <span>ğŸ¼</span> å…¨éŸ³åŸŸéŸ³ç¨‹å°ç…§è¡¨
        </h2>
        <div id="interval-table" class="my-2"></div>
        <button onclick="hideIntervalTable()" class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-5/6 py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white font-bold rounded-xl hover:from-indigo-600 hover:to-indigo-700 shadow-lg transition mt-2">
            é—œé–‰éŸ³ç¨‹è¡¨
        </button>
    </div>
</div>

<script>
    // -------------------------------------------------------------------
    // --- æ ¸å¿ƒéŸ³æ¨‚æ•¸æ“š (èˆ‡ V3 ç›¸åŒï¼Œå·²åŒ…å«è±å¯Œçš„å’Œå¼¦é¡å‹) ---
    // -------------------------------------------------------------------
    const NOTES_FOR_PARSING = [
        "C#", "Db", "D#", "Eb", "F#", "Gb", "G#", "Ab", "A#", "Bb", 
        "C", "D", "E", "F", "G", "A", "B"
    ];
    const PITCHES = {
        "C": 0, "C#": 1, "Db": 1, "D": 2, "D#": 3, "Eb": 3, 
        "E": 4, "F": 5, "F#": 6, "Gb": 6, "G": 7, "G#": 8, 
        "Ab": 8, "A": 9, "A#": 10, "Bb": 10, "B": 11
    };
    const OUTPUT_NOTES = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
    const INTERVAL_NAMES = {
        0: "æ ¹éŸ³ (R)", 1: "å°äºŒåº¦ (b2)", 2: "å¤§äºŒåº¦ (M2)", 3: "å°ä¸‰åº¦ (m3)", 4: "å¤§ä¸‰åº¦ (M3)", 
        5: "å®Œå…¨å››åº¦ (P4)", 6: "æ¸›äº”åº¦ (b5)/å¢å››åº¦ (#4)", 7: "å®Œå…¨äº”åº¦ (P5)", 8: "å¢äº”åº¦ (#5)", 
        9: "å¤§å…­åº¦ (M6)", 10: "å°ä¸ƒåº¦ (m7)", 11: "å¤§ä¸ƒåº¦ (M7)", 12: "å…«åº¦ (8)",
        14: "å¤§ä¹åº¦ (M9)", 15: "å°ååº¦ (m10)", 17: "å®Œå…¨åä¸€åº¦ (P11)", 18: "å¢åä¸€åº¦ (#11)", 
        21: "å¤§åä¸‰åº¦ (M13)"
    };
    const CHORDS = {
        "":        ["å¤§ä¸‰å’Œå¼¦", [4, 7], "ç”±æ ¹éŸ³ã€å¤§ä¸‰åº¦ã€å®Œå…¨äº”åº¦æ§‹æˆã€‚æ˜äº®ã€ç©©å®šã€‚"],
        "m":       ["å°ä¸‰å’Œå¼¦", [3, 7], "ç”±æ ¹éŸ³ã€å°ä¸‰åº¦ã€å®Œå…¨äº”åº¦æ§‹æˆã€‚æŸ”å’Œã€æ†‚é¬±ã€‚"],
        "dim":     ["æ¸›ä¸‰å’Œå¼¦", [3, 6], "ç”±æ ¹éŸ³ã€å°ä¸‰åº¦ã€æ¸›äº”åº¦æ§‹æˆã€‚æ¥µåº¦ä¸ç©©å®šã€‚"],
        "aug":     ["å¢ä¸‰å’Œå¼¦", [4, 8], "ç”±æ ¹éŸ³ã€å¤§ä¸‰åº¦ã€å¢äº”åº¦æ§‹æˆã€‚ä¸ç©©å®šã€æœ‰æ“´å¼µæ„Ÿã€‚"],
        "sus4":    ["æ›ç•™å››å’Œå¼¦", [5, 7], "å››åº¦å–ä»£ä¸‰åº¦ã€‚ä¸ç©©å®šï¼Œå‚¾å‘è§£æ±ºåˆ°å¤§ä¸‰æˆ–å°ä¸‰å’Œå¼¦ã€‚"],
        "sus2":    ["æ›ç•™äºŒå’Œå¼¦", [2, 7], "äºŒåº¦å–ä»£ä¸‰åº¦ã€‚æ¸…æ–°ã€é–‹æ”¾çš„éŸ³éŸ¿ã€‚"],
        "add9":    ["åŠ ä¹å’Œå¼¦", [4, 7, 14], "å¤§ä¸‰å’Œå¼¦åŠ ä¸Šå¤§ä¹åº¦ï¼ˆæ²’æœ‰ä¸ƒåº¦éŸ³ï¼‰ã€‚æ¯”å–®ç´”å¤§ä¸‰æ›´æŸ”å’Œã€‚"],
        "madd9":   ["å°èª¿åŠ ä¹å’Œå¼¦", [3, 7, 14], "å°ä¸‰å’Œå¼¦åŠ ä¸Šå¤§ä¹åº¦ï¼ˆæ²’æœ‰ä¸ƒåº¦éŸ³ï¼‰ã€‚"],
        "7":       ["å±¬ä¸ƒå’Œå¼¦", [4, 7, 10], "å¤§ä¸‰å’Œå¼¦åŠ ä¸Šå°ä¸ƒåº¦ã€‚å…·æœ‰å¼·çƒˆå‚¾å‘è§£æ±ºçš„å±¬åŠŸèƒ½ã€‚"],
        "maj7":    ["å¤§ä¸ƒå’Œå¼¦", [4, 7, 11], "å¤§ä¸‰å’Œå¼¦åŠ ä¸Šå¤§ä¸ƒåº¦ã€‚æŸ”å’Œã€å¯¬å»£ã€å¸¶æœ‰çˆµå£«è‰²å½©ã€‚"],
        "m7":      ["å°ä¸ƒå’Œå¼¦", [3, 7, 10], "å°ä¸‰å’Œå¼¦åŠ ä¸Šå°ä¸ƒåº¦ã€‚å…§æ–‚ã€è±å¯Œã€å¸¸ç”¨æ–¼çˆµå£«å’Œæµè¡Œã€‚"],
        "mmaj7":   ["å°å¤§ä¸ƒå’Œå¼¦", [3, 7, 11], "å°ä¸‰å’Œå¼¦åŠ ä¸Šå¤§ä¸ƒåº¦ã€‚è‰²å½©ç¨ç‰¹ï¼Œå¸¸ç‡Ÿé€ ç¥ç§˜æˆ–ç·Šå¼µæ„Ÿã€‚"],
        "m7b5":    ["åŠæ¸›ä¸ƒå’Œå¼¦", [3, 6, 10], "ç”±æ¸›ä¸‰å’Œå¼¦åŠ ä¸Šå°ä¸ƒåº¦æ§‹æˆã€‚å¸¸ä½œç‚ºå°èª¿çš„äºŒç´šå’Œå¼¦ã€‚"],
        "dim7":    ["æ¸›ä¸ƒå’Œå¼¦", [3, 6, 9], "ç”±æ¸›ä¸‰å’Œå¼¦åŠ ä¸Šæ¸›ä¸ƒåº¦ï¼ˆé›™é™ä¸ƒåº¦ï¼‰ã€‚é«˜åº¦å°ç¨±ï¼Œæ¥µä¸ç©©å®šï¼Œå¸¸ä½œè½‰èª¿ç”¨ã€‚"],
        "7#5":     ["å¢å±¬ä¸ƒå’Œå¼¦", [4, 8, 10], "å±¬ä¸ƒå’Œå¼¦çš„äº”åº¦éŸ³å‡é«˜åŠéŸ³ã€‚"],
        "7b5":     ["æ¸›äº”å±¬ä¸ƒå’Œå¼¦", [4, 6, 10], "å±¬ä¸ƒå’Œå¼¦çš„äº”åº¦éŸ³é™ä½åŠéŸ³ã€‚"],
        "7#9":     ["å±¬ä¸ƒå‡ä¹å’Œå¼¦", [4, 7, 10, 15], "å±¬ä¸ƒå’Œå¼¦åŠ ä¸Šå¢ä¹åº¦ (å°ä¸‰åº¦)ã€‚å¼·çƒˆçš„å±¬åŠŸèƒ½ã€‚"],
        "7b9":     ["å±¬ä¸ƒé™ä¹å’Œå¼¦", [4, 7, 10, 13], "å±¬ä¸ƒå’Œå¼¦åŠ ä¸Šå°ä¹åº¦ã€‚å¼·çƒˆçš„è§£æ±ºè¶¨å‹¢ã€‚"],
        "9":       ["å±¬ä¹å’Œå¼¦", [4, 7, 10, 14], "å±¬ä¸ƒå’Œå¼¦åŠ ä¸Šå¤§ä¹åº¦ã€‚é£½æ»¿ã€çˆµå£«å‘³æ¿ƒåšã€‚"],
        "m9":      ["å°ä¹å’Œå¼¦", [3, 7, 10, 14], "å°ä¸ƒå’Œå¼¦åŠ ä¸Šå¤§ä¹åº¦ã€‚æ·±æ²‰ã€è±å¯Œã€å¸¸ç‡Ÿé€ å†·éœæ°›åœã€‚"],
        "maj9":    ["å¤§ä¹å’Œå¼¦", [4, 7, 11, 14], "å¤§ä¸ƒå’Œå¼¦åŠ ä¸Šå¤§ä¹åº¦ã€‚æ¥µå…¶æŸ”å’Œã€é«˜é›…çš„çˆµå£«è‰²å½©ã€‚"],
        "11":      ["å±¬åä¸€å’Œå¼¦", [4, 7, 10, 14, 17], "å±¬ä¹å’Œå¼¦åŠ ä¸Šå®Œå…¨åä¸€åº¦ã€‚é€šå¸¸çœç•¥ä¸‰åº¦éŸ³ã€‚"],
        "m11":     ["å°åä¸€å’Œå¼¦", [3, 7, 10, 14, 17], "å°ä¹å’Œå¼¦åŠ ä¸Šå®Œå…¨åä¸€åº¦ã€‚å¸¸ç”¨æ–¼çˆµå£«æ¨‚çš„äºŒç´šå’Œå¼¦ã€‚"],
        "maj11":   ["å¤§åä¸€å’Œå¼¦", [4, 7, 11, 14, 17], "å¤§ä¹å’Œå¼¦åŠ ä¸Šå®Œå…¨åä¸€åº¦ã€‚è¼ƒå°‘è¦‹ã€‚"],
        "#11":     ["å±¬ä¸ƒå‡åä¸€å’Œå¼¦", [4, 7, 10, 14, 18], "å±¬ä¹å’Œå¼¦åŠ ä¸Šå¢åä¸€åº¦ã€‚å¸¶æœ‰Lydianè‰²å½©ã€‚"],
        "maj#11":  ["å¤§ä¸ƒå‡åä¸€å’Œå¼¦", [4, 7, 11, 14, 18], "å¤§ä¹å’Œå¼¦åŠ ä¸Šå¢åä¸€åº¦ã€‚å…¸å‹çš„Lydianå’Œå¼¦ï¼Œæ˜äº®è€Œå¤¢å¹»ã€‚"],
        "13":      ["å±¬åä¸‰å’Œå¼¦", [4, 7, 10, 14, 17, 21], "å±¬åä¸€å’Œå¼¦åŠ ä¸Šå¤§åä¸‰åº¦ã€‚æœ€è±æ»¿çš„å±¬åŠŸèƒ½å’Œå¼¦ã€‚"],
        "m13":     ["å°åä¸‰å’Œå¼¦", [3, 7, 10, 14, 17, 21], "å°åä¸€å’Œå¼¦åŠ ä¸Šå¤§åä¸‰åº¦ã€‚æº«æš–è€Œæ·±é‚ƒçš„çˆµå£«è‰²å½©ã€‚"],
        "maj13":   ["å¤§åä¸‰å’Œå¼¦", [4, 7, 11, 14, 17, 21], "å¤§åä¸€å’Œå¼¦åŠ ä¸Šå¤§åä¸‰åº¦ã€‚æ¥µå…¶è±å¯Œã€å¹³éœçš„å’Œå¼¦ã€‚"],
    };

    function getNoteName(index) { return OUTPUT_NOTES[index % 12]; }
    
    function getChordTonesAndIntervals(rootName, intervals) {
        const rootIndex = PITCHES[rootName];
        if (rootIndex === undefined) return { tones: [], intervals: [] };

        const tones = [rootName];
        const intervalNames = [INTERVAL_NAMES[0]];

        for (const interval of intervals) {
            const toneIndex = (rootIndex + interval) % 12;
            const noteName = getNoteName(toneIndex);
            
            tones.push(noteName);
            intervalNames.push(INTERVAL_NAMES[interval] || `æœªçŸ¥ (${interval} åŠéŸ³)`);
        }
        return { tones, intervals: intervalNames };
    }

    function parseChordInput(input) {
        const upperInput = input.toUpperCase().replace(/\s/g, '');

        for (const note of NOTES_FOR_PARSING) {
            if (upperInput.startsWith(note)) {
                const rootName = note;
                let quality = upperInput.substring(note.length).toLowerCase();
                
                quality = quality.replace(/\(maj7\)/, 'maj7');
                quality = quality.replace(/(-5|\(b5\))/, 'b5');
                if (quality.startsWith('add')) quality = 'add' + quality.substring(3);
                if (quality.startsWith('sus')) quality = 'sus' + quality.substring(3);
                
                if (quality === "#5") quality = "aug"; 
                if (quality === "b5") quality = "dim"; 

                return { rootName, quality };
            }
        }
        return null;
    }

    function translateChord() {
        const input = document.getElementById('chordInput').value.trim();
        const resultDiv = document.getElementById('result');
        resultDiv.className = "mt-8 p-5 bg-white border border-indigo-100 rounded-xl text-gray-800 shadow-md transition duration-300";

        if (!input) {
            resultDiv.innerHTML = "<p class='text-center text-lg text-gray-500'>è«‹è¼¸å…¥ä¸€å€‹æœ‰æ•ˆçš„å’Œå¼¦åç¨±ï¼</p>";
            return;
        }

        let parsed = parseChordInput(input);
        
        if (!parsed) {
             const singleRoot = input.toUpperCase();
             if (PITCHES.hasOwnProperty(singleRoot) && singleRoot.length <= 2) {
                 parsed = { rootName: singleRoot, quality: "" };
             } else {
                 resultDiv.innerHTML = `<p class='text-center text-lg text-red-500 font-semibold'>ç„¡æ³•è­˜åˆ¥çš„æ ¹éŸ³ï¼š<strong>${input}</strong></p><p class='text-center text-gray-500'>è«‹ä½¿ç”¨æ¨™æº–éŸ³å C, D, Eb, F#, Bb, ç­‰ã€‚</p>`;
                 return;
             }
        }
        
        const { rootName, quality } = parsed;
        const chordInfo = CHORDS[quality];

        if (!chordInfo) {
            resultDiv.innerHTML = `<p class='text-center text-lg text-red-500 font-semibold'>ç„¡æ³•è­˜åˆ¥çš„å’Œå¼¦é¡å‹ï¼š<strong>${quality || "ï¼ˆå¤§ä¸‰å’Œå¼¦é™¤å¤–ï¼‰"}</strong></p><p class='text-center text-gray-500'>è«‹ç¢ºèªè¼¸å…¥çš„å’Œå¼¦è¨˜è™Ÿæ˜¯å¦æ¨™æº–ã€‚</p>`;
            return;
        }

        const [chordName, intervals, definition] = chordInfo;
        const { tones, intervals: intervalNames } = getChordTonesAndIntervals(rootName, intervals);
        
        if (tones.length === 0) {
             resultDiv.innerHTML = `<p class='text-center text-lg text-red-500'>å…§éƒ¨éŒ¯èª¤ï¼šç„¡æ³•è¨ˆç®—å’Œå¼¦éŸ³ã€‚</p>`;
             return;
        }

        let output = `
<div class="space-y-6">
    <p class="text-2xl font-extrabold text-indigo-700 text-center tracking-wide">
        ${rootName}${quality} 
        <span class="block text-base font-medium text-gray-500 mt-1">(${rootName}${chordName})</span>
    </p>
    <div class="bg-gradient-to-r from-indigo-50 via-white to-indigo-100 p-4 rounded-xl border border-indigo-50 shadow">
        <p class="text-xl font-bold text-gray-800 mb-2 border-b border-indigo-100 pb-1">ğŸµ çµ„æˆéŸ³:</p>
        <p class="text-4xl font-mono tracking-wider text-red-600 text-center">${tones.join(' - ')}</p>
    </div>
    <div class="p-4 rounded-xl border border-indigo-100 bg-white shadow">
        <p class="text-xl font-bold text-gray-800 mb-3 border-b border-indigo-100 pb-1">ğŸ¶ éŸ³ç¨‹é—œä¿‚:</p>
        <div class="grid grid-cols-2 gap-3 text-sm sm:text-base">
            ${tones.map((tone, index) => 
                `<p class="flex items-center"><span class="font-mono bg-indigo-100 text-indigo-700 px-2 py-1 rounded mr-2 w-12 text-center">${tone}</span> <span class="text-gray-600">${intervalNames[index]}</span></p>`
            ).join('')}
        </div>
    </div>
    <p class="text-base pt-2 border-t border-indigo-100">
        <span class="font-bold text-indigo-700">âœ¨ å®šç¾©èˆ‡ç‰¹æ€§ï¼š</span> ${definition}
    </p>
</div>
        `;
        resultDiv.innerHTML = output;
    }

    // --- èªªæ˜æ›¸åŠŸèƒ½ ---
    function showManual() {
        document.getElementById('menu-toggle').checked = false; 
        document.getElementById('manual-modal').classList.remove('hidden');
        document.getElementById('manual-modal').classList.add('flex');
    }
    function hideManual(event) {
        if (event && event.target.id !== 'manual-modal') return; 
        document.getElementById('manual-modal').classList.remove('flex');
        document.getElementById('manual-modal').classList.add('hidden');
    }
    // --- éŸ³ç¨‹è¡¨åŠŸèƒ½ ---
    function showIntervalTable() {
        document.getElementById('menu-toggle').checked = false;
        document.getElementById('interval-modal').classList.remove('hidden');
        document.getElementById('interval-modal').classList.add('flex');
        renderIntervalTable();
    }
    function hideIntervalTable(event) {
        if (event && event.target.id !== 'interval-modal') return;
        document.getElementById('interval-modal').classList.remove('flex');
        document.getElementById('interval-modal').classList.add('hidden');
    }

    // éŸ³ç¨‹è¡¨è³‡æ–™ï¼ˆCSVæ ¼å¼æ”¹ç‚º JS é™£åˆ—ï¼‰
    const intervalTableCSV = `æ ¹éŸ³ (Root),P1 (0),m2 (1),M2 (2),m3 (3),M3 (4),P4 (5),A4/d5 (6),P5 (7),A5/m6 (8),M6 (9),m7 (10),M7 (11),P8 (12)
C,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C
C#/Dâ™­,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­
D,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D
D#/Eâ™­,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­
E,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E
F,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F
F#/Gâ™­,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­
G,G,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G
G#/Aâ™­,G#/Aâ™­,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­
A,A,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A
A#/Bâ™­,A#/Bâ™­,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­
B,B,C,C#/Dâ™­,D,D#/Eâ™­,E,F,F#/Gâ™­,G,G#/Aâ™­,A,A#/Bâ™­,B`;

    function renderIntervalTable() {
        const rows = intervalTableCSV.trim().split('\n').map(r => r.split(','));
        let html = '<div class="overflow-x-auto"><table class="min-w-full border border-indigo-100 rounded-xl text-center text-sm shadow-sm bg-white">';
        html += '<thead class="bg-indigo-50">';
        html += '<tr>' + rows[0].map(cell => `<th class="px-3 py-2 font-bold text-indigo-700">${cell}</th>`).join('') + '</tr></thead>';
        html += '<tbody>';
        for(let i=1;i<rows.length;i++) {
            html += '<tr>' + rows[i].map(cell => `<td class="px-2 py-1 border-t border-indigo-50 font-mono">${cell}</td>`).join('') + '</tr>';
        }
        html += '</tbody></table></div>';
        document.getElementById('interval-table').innerHTML = html;
    }

    // Esc é—œé–‰ Modal
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.getElementById('manual-modal').classList.remove('flex');
            document.getElementById('manual-modal').classList.add('hidden');
            document.getElementById('interval-modal').classList.remove('flex');
            document.getElementById('interval-modal').classList.add('hidden');
            document.getElementById('menu-toggle').checked = false;
        }
    });
</script>

</body>
</html>