<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>格里曆日期計算機 (優化版)</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts 的 Inter 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* 頁籤切換的過渡效果 */
        .tab-panel {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">格里曆日期計算機</h1>

        <!-- 功能頁籤選單 -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex space-x-6" id="tabs">
                <button data-target="panel-1" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-blue-500 text-blue-600">
                    日期互換
                </button>
                <button data-target="panel-2" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    天數加減
                </button>
                <button data-target="panel-3" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    日期差距
                </button>
            </nav>
        </div>

        <!-- 功能內容面板 -->
        <div id="panels">
            <!-- 功能一：日期與格里日數互換 -->
            <div id="panel-1" class="tab-panel space-y-6">
                <div>
                    <h3 class="text-lg font-medium text-gray-700 mb-3 flex justify-between items-center">
                        <span>日期 ➔ 格里日數 (JD)</span>
                        <button class="fill-today-btn text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 font-semibold py-1 px-2 rounded-md" data-target-group="1">今日</button>
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <input type="number" id="year1" placeholder="年" class="date-input-1 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <input type="number" id="month1" placeholder="月" class="date-input-1 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <input type="number" id="day1" placeholder="日" class="date-input-1 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button id="convert-to-jd" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">轉換 ➔ JD</button>
                    <div id="jd-result" class="mt-4 text-center p-3 bg-gray-50 rounded-lg min-h-[50px] flex items-center justify-center"></div>
                </div>
                <div class="pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">格里日數 (JD) ➔ 日期</h3>
                    <input type="number" step="any" id="jd-input" placeholder="例如: 2460676.5" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <button id="convert-to-date" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">轉換 ➔ 日期</button>
                    <div id="date-result" class="mt-4 text-center p-3 bg-gray-50 rounded-lg min-h-[50px] flex items-center justify-center"></div>
                </div>
            </div>

            <!-- 功能二：日期天數加減 -->
            <div id="panel-2" class="tab-panel hidden space-y-4">
                <h3 class="text-lg font-medium text-gray-700 flex justify-between items-center">
                    <span>起始日期</span>
                    <button class="fill-today-btn text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 font-semibold py-1 px-2 rounded-md" data-target-group="2">今日</button>
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <input type="number" id="year2" placeholder="年" class="date-input-2 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    <input type="number" id="month2" placeholder="月" class="date-input-2 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    <input type="number" id="day2" placeholder="日" class="date-input-2 mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                     <label for="days-offset" class="block text-sm font-medium text-gray-600">加/減天數 (N)</label>
                     <input type="number" id="days-offset" placeholder="例如: 100" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button id="add-days" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">增加天數 (+)</button>
                    <button id="subtract-days" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">減少天數 (-)</button>
                </div>
                 <div id="calc-result" class="text-center p-3 bg-gray-50 rounded-lg min-h-[50px] flex items-center justify-center"></div>
            </div>
            
            <!-- 功能三：計算日期差距 -->
            <div id="panel-3" class="tab-panel hidden space-y-4">
                <div>
                    <h3 class="text-lg font-medium text-gray-700 mb-3 flex justify-between items-center">
                        <span>起始日期</span>
                        <button class="fill-today-btn text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 font-semibold py-1 px-2 rounded-md" data-target-group="3-start">今日</button>
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <input type="number" id="year3_start" placeholder="年" class="date-input-3-start block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                        <input type="number" id="month3_start" placeholder="月" class="date-input-3-start block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                        <input type="number" id="day3_start" placeholder="日" class="date-input-3-start block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-gray-700 mb-3 flex justify-between items-center">
                        <span>結束日期</span>
                        <button class="fill-today-btn text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 font-semibold py-1 px-2 rounded-md" data-target-group="3-end">今日</button>
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <input type="number" id="year3_end" placeholder="年" class="date-input-3-end block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                        <input type="number" id="month3_end" placeholder="月" class="date-input-3-end block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                        <input type="number" id="day3_end" placeholder="日" class="date-input-3-end block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                    </div>
                </div>
                <button id="calculate-diff" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">計算天數差距</button>
                <div id="diff-result" class="text-center p-3 bg-gray-50 rounded-lg min-h-[50px] flex items-center justify-center"></div>
            </div>
        </div>
    </div>

    <script>
        // --- 演算法函式 ---
        function gregorianToJD(year, month, day) {
            if (month <= 2) { month += 12; year--; }
            const A = Math.floor(year / 100);
            const B = 2 - A + Math.floor(A / 4);
            return Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) + day + B - 1524.5;
        }

        function JDToDate(JD) {
            JD += 0.5;
            const Z = Math.floor(JD);
            const F = JD - Z;
            let A = Z < 2299161 ? Z : Z + 1 + Math.floor((Z - 1867216.25) / 36524.25) - Math.floor(Math.floor((Z - 1867216.25) / 36524.25) / 4);
            const B = A + 1524;
            const C = Math.floor((B - 122.1) / 365.25);
            const D = Math.floor(365.25 * C);
            const G = Math.floor((B - D) / 30.6001);
            const day = Math.floor(B - D - Math.floor(30.6001 * G) + F);
            const month = G < 14 ? G - 1 : G - 13;
            const year = month > 2 ? C - 4716 : C - 4715;
            return { year, month, day };
        }
        
        // --- 初始化與 DOM 操作 ---
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const panels = document.querySelectorAll('.tab-panel');
            const todayBtns = document.querySelectorAll('.fill-today-btn');

            // 頁籤切換邏輯
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(item => {
                        item.classList.remove('border-blue-500', 'text-blue-600');
                        item.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    tab.classList.add('border-blue-500', 'text-blue-600');
                    tab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

                    const targetPanelId = tab.dataset.target;
                    panels.forEach(panel => {
                        if (panel.id === targetPanelId) {
                            panel.classList.remove('hidden');
                        } else {
                            panel.classList.add('hidden');
                        }
                    });
                });
            });
            
            // "今日" 按鈕邏輯
            todayBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = today.getMonth() + 1;
                    const day = today.getDate();
                    const group = btn.dataset.targetGroup;

                    const inputs = document.querySelectorAll(`.date-input-${group}`);
                    if(inputs.length === 3) {
                         inputs[0].value = year;
                         inputs[1].value = month;
                         inputs[2].value = day;
                    }
                });
            });

            // 顯示結果的輔助函式
            function displayResult(element, message, isError = false) {
                element.innerHTML = `<span class="${isError ? 'text-red-500' : 'text-gray-800'} font-semibold text-lg">${message}</span>`;
            }

            // 清空所有結果區域
            function clearAllResults() {
                document.querySelectorAll('#jd-result, #date-result, #calc-result, #diff-result').forEach(el => {
                    el.innerHTML = `<span class="text-gray-500">此處將顯示結果</span>`;
                });
            }
            clearAllResults(); // 頁面載入時先清空

            // --- 事件監聽 ---
            const el = id => document.getElementById(id);

            el('convert-to-jd').addEventListener('click', () => {
                const [y, m, d] = [parseInt(el('year1').value), parseInt(el('month1').value), parseInt(el('day1').value)];
                if (isNaN(y) || isNaN(m) || isNaN(d)) return displayResult(el('jd-result'), '請輸入完整的年、月、日', true);
                displayResult(el('jd-result'), `格里日數 (JD): ${gregorianToJD(y, m, d)}`);
            });

            el('convert-to-date').addEventListener('click', () => {
                const jd = parseFloat(el('jd-input').value);
                if (isNaN(jd)) return displayResult(el('date-result'), '請輸入有效的格里日數', true);
                const date = JDToDate(jd);
                displayResult(el('date-result'), `日期: ${date.year} 年 ${date.month} 月 ${date.day} 日`);
            });

            function handleDateCalculation(isAddition) {
                const [y, m, d, offset] = [parseInt(el('year2').value), parseInt(el('month2').value), parseInt(el('day2').value), parseInt(el('days-offset').value)];
                if (isNaN(y) || isNaN(m) || isNaN(d) || isNaN(offset)) return displayResult(el('calc-result'), '請輸入完整的起始日期與天數', true);
                const newJd = gregorianToJD(y, m, d) + (isAddition ? offset : -offset);
                const newDate = JDToDate(newJd);
                displayResult(el('calc-result'), `新日期: ${newDate.year} 年 ${newDate.month} 月 ${newDate.day} 日`);
            }
            
            el('add-days').addEventListener('click', () => handleDateCalculation(true));
            el('subtract-days').addEventListener('click', () => handleDateCalculation(false));

            el('calculate-diff').addEventListener('click', () => {
                const [y1, m1, d1] = [parseInt(el('year3_start').value), parseInt(el('month3_start').value), parseInt(el('day3_start').value)];
                const [y2, m2, d2] = [parseInt(el('year3_end').value), parseInt(el('month3_end').value), parseInt(el('day3_end').value)];
                if (isNaN(y1) || isNaN(m1) || isNaN(d1) || isNaN(y2) || isNaN(m2) || isNaN(d2)) return displayResult(el('diff-result'), '請輸入完整的起始與結束日期', true);
                const diff = Math.round(Math.abs(gregorianToJD(y2, m2, d2) - gregorianToJD(y1, m1, d1)));
                displayResult(el('diff-result'), `兩個日期相差 ${diff} 天`);
            });
        });
    </script>
</body>
</html>

