<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸæ—å™ªè²æ¨¡æ“¬å™¨ v1.0.0 (Perlin Noise Simulator)</title>
    <!-- å¼•å…¥ p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #4CAF50;
            --secondary-color: #2196F3;
            --danger-color: #f44336;
            --border-color: #333;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* å·¦å´æ§åˆ¶é¢æ¿ */
        .sidebar {
            width: 340px;
            background-color: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .section {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        h1 {
            font-size: 1.2rem;
            margin: 0 0 20px 0;
            color: var(--accent-color);
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        h2 {
            font-size: 0.9rem;
            margin: 0 0 10px 0;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* è¡¨å–®æ§åˆ¶é …æ¨£å¼ */
        .control-group {
            margin-bottom: 12px;
        }

        label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .value-display {
            color: var(--secondary-color);
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--accent-color);
        }

        input[type="number"], input[type="text"], select {
            background: #2a2a2a;
            border: 1px solid #444;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        input[type="number"]:focus, input[type="text"]:focus, select:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
            width: 100%;
        }

        button:hover {
            filter: brightness(1.1);
        }

        button.outline {
            background: transparent;
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
        }
        
        button.outline:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        /* ä¸»è¦ç•«å¸ƒå€åŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                linear-gradient(45deg, #1a1a1a 25%, transparent 25%), 
                linear-gradient(-45deg, #1a1a1a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #1a1a1a 75%), 
                linear-gradient(-45deg, transparent 75%, #1a1a1a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            position: relative;
        }

        #canvas-container {
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 2px solid #444;
            max-width: 90%;
            max-height: 90%;
            display: flex;
        }

        /* æ¨™ç±¤æç¤º */
        .preset-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #666;
            margin-top: 2px;
        }

        /* åŒ¯å‡ºå€åŸŸ */
        .export-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        /* åˆ‡æ›é–‹é—œ */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
            flex-direction: column;
        }
        
        /* Tooltip */
        .tooltip-icon {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: #555;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 14px;
            font-size: 10px;
            cursor: help;
            margin-left: 5px;
        }
    </style>
</head>
<body>

    <!-- å´é‚Šæ¬„ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="sidebar">
        <h1>æŸæ—å™ªè²æ¨¡æ“¬å™¨ v1.0.0</h1>

        <!-- 1. ç¨®å­æ§åˆ¶ -->
        <div class="section">
            <h2>ç¨®å­ (Seed)</h2>
            <div class="btn-group">
                <input type="text" id="seedInput" value="12345" placeholder="è¼¸å…¥æ–‡å­—æˆ–æ•¸å­—">
                <button id="randomSeedBtn" style="width: 40%;" title="éš¨æ©Ÿç”Ÿæˆ">ğŸ² éš¨æ©Ÿ</button>
            </div>
        </div>

        <!-- 2. æ ¸å¿ƒåƒæ•¸ -->
        <div class="section">
            <h2>æ ¸å¿ƒåƒæ•¸</h2>
            
            <!-- ç¶²æ ¼ç¸®æ”¾ -->
            <div class="control-group">
                <label>
                    <span>ç¸®æ”¾ (Scale) <span class="tooltip-icon" title="æ§åˆ¶å™ªè²åœ–æ¡ˆçš„å¤§å°ã€‚æ•¸å€¼è¶Šå°ï¼Œåœ°å½¢è¶Šå®è§€ï¼›æ•¸å€¼è¶Šå¤§ï¼Œè¶Šç´°ç¢ã€‚">?</span></span>
                    <span id="scaleVal" class="value-display">0.015</span>
                </label>
                <input type="range" id="scaleSlider" min="0.001" max="0.1" step="0.001" value="0.015">
                <div class="preset-labels">
                    <span>å®è§€</span>
                    <span>æ¨™æº–</span>
                    <span>ç´°ç¢</span>
                </div>
            </div>

            <!-- å…«åº¦å±¤æ•¸ -->
            <div class="control-group">
                <label>
                    <span>å…«åº¦å±¤æ•¸ (Octaves) <span class="tooltip-icon" title="ç–ŠåŠ çš„å™ªè²å±¤æ•¸ã€‚å±¤æ•¸è¶Šå¤šï¼Œç´°ç¯€è¶Šè±å¯Œï¼Œä½†è¨ˆç®—é‡è¶Šå¤§ã€‚">?</span></span>
                    <span id="octavesVal" class="value-display">3</span>
                </label>
                <input type="range" id="octavesSlider" min="1" max="10" step="1" value="3">
            </div>

            <!-- æŒçºŒåº¦ -->
            <div class="control-group">
                <label>
                    <span>æŒçºŒåº¦ (Persistence) <span class="tooltip-icon" title="æ§åˆ¶æ¯ä¸€å±¤ç´°ç¯€çš„æŒ¯å¹…æ¬Šé‡ã€‚æ•¸å€¼è¶Šé«˜ï¼Œç´°ç¯€å°æ¯”åº¦è¶Šå¼·ã€‚">?</span></span>
                    <span id="persVal" class="value-display">0.5</span>
                </label>
                <input type="range" id="persSlider" min="0.0" max="1.0" step="0.05" value="0.5">
            </div>

            <!-- é–“éš™åº¦ -->
            <div class="control-group">
                <label>
                    <span>é–“éš™åº¦ (Lacunarity) <span class="tooltip-icon" title="æ§åˆ¶æ¯ä¸€å±¤ç´°ç¯€çš„é »ç‡å€æ•¸ã€‚">?</span></span>
                    <span id="lacVal" class="value-display">2.0</span>
                </label>
                <input type="range" id="lacSlider" min="1.0" max="4.0" step="0.1" value="2.0">
            </div>
        </div>

        <!-- 3. å‹•ç•«èˆ‡è¦–è¦ºåŒ– -->
        <div class="section">
            <h2>è¦–è¦ºèˆ‡å‹•ç•«</h2>
            
            <!-- å‹•ç•«é€Ÿåº¦ -->
            <div class="control-group">
                <label>
                    <span>å‹•ç•«é€Ÿåº¦ (Time Speed)</span>
                    <span id="speedVal" class="value-display">0.01</span>
                </label>
                <input type="range" id="speedSlider" min="0" max="0.05" step="0.001" value="0.01">
            </div>

            <!-- ä¸»é¡Œé¸æ“‡ -->
            <div class="control-group">
                <label>è‰²å½©ä¸»é¡Œ (Theme)</label>
                <select id="themeSelect">
                    <option value="terrain">â›°ï¸ åœ°å½¢é«˜åº¦åœ– (Terrain)</option>
                    <option value="lava">ğŸ”¥ ç†”å²©ç«ç„° (Lava)</option>
                    <option value="ocean">ğŸŒŠ æ·±æµ·ç†±åœ– (Ocean)</option>
                    <option value="grayscale">âš« ç°éš (Grayscale)</option>
                </select>
            </div>

            <!-- åˆ†å±¤æ¨¡å¼åˆ‡æ› -->
            <div class="toggle-container">
                <input type="checkbox" id="stepToggle">
                <label for="stepToggle">å•Ÿç”¨åˆ†å±¤æ­¥é€² (Stepping)</label>
            </div>
            
            <div class="control-group" id="stepCountGroup" style="display:none; margin-top:10px;">
                 <label>
                    <span>åˆ†å±¤æ•¸é‡</span>
                    <span id="stepCountVal" class="value-display">10</span>
                </label>
                <input type="range" id="stepSlider" min="2" max="20" step="1" value="10">
            </div>
        </div>

        <!-- 4. åŒ¯å‡º -->
        <div class="section">
            <h2>åŒ¯å‡ºåœ–ç‰‡</h2>
            <div class="export-grid">
                <div>
                    <label>å¯¬åº¦ (px)</label>
                    <input type="number" id="exportWidth" value="1024" min="64" max="4096">
                </div>
                <div>
                    <label>é«˜åº¦ (px)</label>
                    <input type="number" id="exportHeight" value="1024" min="64" max="4096">
                </div>
            </div>
            <div class="control-group">
                <label>æ ¼å¼</label>
                <select id="exportFormat">
                    <option value="png">PNG (ç„¡æ)</option>
                    <option value="jpg">JPG (è¼ƒå°)</option>
                </select>
            </div>
            <button id="exportBtn">â¬‡ï¸ ç”Ÿæˆä¸¦ä¸‹è¼‰</button>
        </div>
        
        <div style="font-size: 0.8rem; color: #666; text-align: center;">
            <p>Designed for GitHub Pages</p>
        </div>
    </div>

    <!-- ä¸»å…§å®¹ï¼šç•«å¸ƒé è¦½ -->
    <div class="main-content">
        <div id="canvas-container">
            <!-- p5.js Canvas æœƒæ’å…¥é€™è£¡ -->
        </div>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div style="font-size: 2rem; margin-bottom: 20px;">âš™ï¸</div>
            <div id="loadingText">æ­£åœ¨ç”Ÿæˆé«˜è§£æåº¦åœ–ç‰‡...</div>
        </div>
    </div>

    <script>
        // === å…¨åŸŸè®Šæ•¸èˆ‡ç‹€æ…‹ ===
        let params = {
            seed: 12345,
            scale: 0.015,
            octaves: 3,
            persistence: 0.5,
            lacunarity: 2.0,
            speed: 0.01,
            theme: 'terrain',
            stepping: false,
            stepCount: 10,
            timeOffset: 0
        };

        let mainCanvas;
        let previewSize = 512; // é è¦½ç•«å¸ƒå¤§å°é™åˆ¶ï¼Œç¢ºä¿ç¶²é æµæš¢

        // === P5.js Setup ===
        function setup() {
            // è¨ˆç®—é©åˆçš„é è¦½å¤§å°
            let container = document.getElementById('main-content');
            // å‰µå»º 512x512 çš„é è¦½ç•«å¸ƒ
            mainCanvas = createCanvas(previewSize, previewSize);
            mainCanvas.parent('canvas-container');
            
            // åˆå§‹åŒ– UI äº‹ä»¶ç›£è½å™¨
            initUI();
            
            // è¨­ç½®åˆå§‹ç¨®å­
            updateSeed();
            
            // è®“ç•«å¸ƒåƒç´ åŒ–ï¼Œé©åˆçœ‹åˆ°åƒç´ é¢¨æ ¼ï¼ˆå¦‚æœç¸®æ”¾å¾ˆå¤§ï¼‰
            noSmooth();
        }

        // === P5.js Draw Loop (å‹•ç•«å¾ªç’°) ===
        function draw() {
            background(0);
            
            // å¦‚æœæœ‰å‹•ç•«é€Ÿåº¦ï¼Œå¢åŠ æ™‚é–“åç§»
            if (params.speed > 0) {
                params.timeOffset += params.speed;
            }

            // è¼‰å…¥åƒç´ æ•¸æ“š
            loadPixels();

            // éæ­·æ‰€æœ‰åƒç´ 
            // æ€§èƒ½å„ªåŒ–ï¼šå°æ–¼é è¦½ï¼Œæˆ‘å€‘å¯ä»¥ä¸è¨ˆç®—æ¯å€‹åƒç´ çš„è¤‡é›œåˆ†å½¢
            // ä½†ç‚ºäº†æº–ç¢ºæ€§ï¼Œæˆ‘å€‘é‚„æ˜¯è¨ˆç®—å®ƒã€‚å¦‚æœå¾ˆå¡ï¼Œå¯ä»¥è€ƒæ…®é™ä½ pixelDensity
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    
                    // 1. ç”Ÿæˆåˆ†å½¢å™ªè²å€¼ (0.0 - 1.0)
                    let noiseVal = fractalNoise(x, y, params.timeOffset, params.scale, params.octaves, params.persistence, params.lacunarity);
                    
                    // 2. è™•ç†åˆ†å±¤ (Stepping)
                    if (params.stepping) {
                        noiseVal = Math.floor(noiseVal * params.stepCount) / (params.stepCount - 1);
                        // ç¢ºä¿ä¸è¶…é 1
                        noiseVal = Math.min(noiseVal, 1); 
                    }

                    // 3. é¡è‰²æ˜ å°„
                    let c = getThemeColor(noiseVal, params.theme);
                    
                    // 4. è¨­å®šåƒç´ 
                    let index = (x + y * width) * 4;
                    pixels[index] = red(c);
                    pixels[index + 1] = green(c);
                    pixels[index + 2] = blue(c);
                    pixels[index + 3] = 255; // Alpha
                }
            }
            
            updatePixels();
            
            // å¦‚æœæš«åœï¼ˆé€Ÿåº¦ç‚º0ï¼‰ï¼Œå‰‡ä¸éœ€è¦ä¸æ–·é‡ç¹ªç¯€çœè³‡æºï¼Œé™¤éåƒæ•¸æ”¹è®Š
            // é€™è£¡ç‚ºäº†ç°¡å–®ä¿æŒå¾ªç’°
        }

        // === æ ¸å¿ƒæ¼”ç®—æ³•ï¼šåˆ†å½¢å™ªè² (Fractal Noise) ===
        // é€™å¯¦ç¾äº†æ­¥é©Ÿ 6ï¼šç–ŠåŠ å…«åº¦
        function fractalNoise(x, y, z, scale, octaves, persistence, lacunarity) {
            let total = 0;
            let amplitude = 1;
            let frequency = scale;
            let maxValue = 0;  // ç”¨æ–¼æ­¸ä¸€åŒ–

            for (let i = 0; i < octaves; i++) {
                // p5.js çš„ noise() æ¥å— x, y, zã€‚é€™è£¡æˆ‘å€‘ç”¨ z åšæ™‚é–“ç¶­åº¦
                // noise è¼¸å‡º 0-1
                total += noise(x * frequency, y * frequency, z) * amplitude;
                
                maxValue += amplitude;
                
                amplitude *= persistence;
                frequency *= lacunarity;
            }

            return total / maxValue; // å°‡çµæœæ­¸ä¸€åŒ–åˆ° 0-1 ä¹‹é–“
        }

        // === é¡è‰²æ˜ å°„å‡½æ•¸ ===
        function getThemeColor(val, theme) {
            // val æ˜¯ 0.0 åˆ° 1.0
            
            if (theme === 'grayscale') {
                return color(val * 255);
            }
            else if (theme === 'terrain') {
                // åœ°å½¢ï¼šæ·±æµ· -> æ·ºæµ· -> æ²™ -> è‰ -> æ— -> å²© -> é›ª
                if (val < 0.30) return lerpColor(color(10, 30, 80), color(30, 80, 200), map(val, 0, 0.3, 0, 1)); // æ·±æµ·
                if (val < 0.45) return lerpColor(color(30, 80, 200), color(50, 150, 220), map(val, 0.3, 0.45, 0, 1)); // æ·ºæµ·
                if (val < 0.50) return lerpColor(color(210, 180, 140), color(238, 214, 175), map(val, 0.45, 0.5, 0, 1)); // æ²™ç˜
                if (val < 0.65) return lerpColor(color(34, 139, 34), color(85, 107, 47), map(val, 0.5, 0.65, 0, 1)); // æ£®æ—
                if (val < 0.80) return lerpColor(color(100, 100, 100), color(160, 160, 160), map(val, 0.65, 0.8, 0, 1)); // å²©çŸ³
                return color(255, 250, 250); // é›ª
            }
            else if (theme === 'lava') {
                // ç†”å²©ï¼šé»‘ -> ç´… -> æ©™ -> é»ƒ -> ç™½
                if (val < 0.3) return color(20, 5, 5); // å†·å»å²©çŸ³
                if (val < 0.5) return lerpColor(color(20, 5, 5), color(180, 20, 0), map(val, 0.3, 0.5, 0, 1));
                if (val < 0.7) return lerpColor(color(180, 20, 0), color(255, 140, 0), map(val, 0.5, 0.7, 0, 1));
                if (val < 0.9) return lerpColor(color(255, 140, 0), color(255, 255, 0), map(val, 0.7, 0.9, 0, 1));
                return color(255, 255, 255);
            }
            else if (theme === 'ocean') {
                // æµ·æ´‹ç†±åœ–ï¼šé»‘/æ·±ç´« -> è— -> é’ -> ç¶  -> é»ƒ -> ç´…
                // é¡ä¼¼ç§‘å­¸è¦–è¦ºåŒ–
                if (val < 0.2) return lerpColor(color(0,0,50), color(0,0,150), map(val,0,0.2,0,1));
                if (val < 0.4) return lerpColor(color(0,0,150), color(0,100,255), map(val,0.2,0.4,0,1));
                if (val < 0.6) return lerpColor(color(0,100,255), color(0,255,200), map(val,0.4,0.6,0,1));
                if (val < 0.8) return lerpColor(color(0,255,200), color(255,255,0), map(val,0.6,0.8,0,1));
                return lerpColor(color(255,255,0), color(255,0,0), map(val,0.8,1.0,0,1));
            }
            return color(255);
        }

        // === UI äº¤äº’é‚è¼¯ ===
        function initUI() {
            // Helper function to bind input to param and display
            function bind(id, paramKey, displayId = null, isFloat = true) {
                const el = document.getElementById(id);
                el.addEventListener('input', () => {
                    let val = isFloat ? parseFloat(el.value) : parseInt(el.value);
                    params[paramKey] = val;
                    if (displayId) {
                        document.getElementById(displayId).innerText = val;
                    }
                });
            }

            bind('scaleSlider', 'scale', 'scaleVal');
            bind('octavesSlider', 'octaves', 'octavesVal', false);
            bind('persSlider', 'persistence', 'persVal');
            bind('lacSlider', 'lacunarity', 'lacVal');
            bind('speedSlider', 'speed', 'speedVal');
            bind('stepSlider', 'stepCount', 'stepCountVal', false);

            // ç¨®å­
            document.getElementById('seedInput').addEventListener('input', (e) => {
                // å°‡å­—ä¸²é›œæ¹Šç‚ºæ•¸å­—
                let val = 0;
                let str = e.target.value;
                for (let i = 0; i < str.length; i++) {
                    val += str.charCodeAt(i);
                }
                params.seed = val;
                updateSeed();
            });

            document.getElementById('randomSeedBtn').addEventListener('click', () => {
                let r = Math.floor(Math.random() * 100000);
                document.getElementById('seedInput').value = r;
                params.seed = r;
                updateSeed();
            });

            // ä¸»é¡Œ
            document.getElementById('themeSelect').addEventListener('change', (e) => {
                params.theme = e.target.value;
            });

            // æ­¥é€²é–‹é—œ
            const stepToggle = document.getElementById('stepToggle');
            const stepGroup = document.getElementById('stepCountGroup');
            stepToggle.addEventListener('change', (e) => {
                params.stepping = e.target.checked;
                stepGroup.style.display = params.stepping ? 'block' : 'none';
            });

            // åŒ¯å‡ºæŒ‰éˆ•
            document.getElementById('exportBtn').addEventListener('click', handleExport);
        }

        function updateSeed() {
            noiseSeed(params.seed);
            params.timeOffset = 0; // é‡ç½®æ™‚é–“
        }

        // === åŒ¯å‡ºé‚è¼¯ ===
        async function handleExport() {
            const w = parseInt(document.getElementById('exportWidth').value);
            const h = parseInt(document.getElementById('exportHeight').value);
            const fmt = document.getElementById('exportFormat').value;

            // æ€§èƒ½è­¦å‘Š
            if (w * h > 2048 * 2048) {
                const proceed = confirm(`æ‚¨é¸æ“‡äº†éå¸¸é«˜çš„è§£æåº¦ (${w}x${h})ã€‚\né€™å¯èƒ½éœ€è¦å¹¾ç§’é˜ç”šè‡³æ›´ä¹…ï¼Œä¸¦å¯èƒ½å°è‡´ç€è¦½å™¨æš«æ™‚ç„¡å›æ‡‰ã€‚\n\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ`);
                if (!proceed) return;
            }

            // é¡¯ç¤º Loading
            const loading = document.getElementById('loadingOverlay');
            loading.style.display = 'flex';

            // ä½¿ç”¨ setTimeout è®“ UI æœ‰æ©Ÿæœƒæ¸²æŸ“ Loading ç•«é¢
            setTimeout(() => {
                // å‰µå»ºä¸€å€‹éš±è—çš„ Graphics Buffer
                let pg = createGraphics(w, h);
                pg.noSmooth();
                pg.loadPixels();

                // ç‚ºäº†åŒ¯å‡ºï¼Œæˆ‘å€‘ä½¿ç”¨ç›®å‰çš„æ™‚é–“åç§»é‡ï¼Œæ•æ‰ç•¶å‰é€™ä¸€å¹€
                // æ³¨æ„ï¼šé€™è£¡æˆ‘å€‘åœ¨ buffer ä¸Šé‡ç¹ªä¸€éï¼Œä¸ä¾è³´ screen pixels
                
                // p5 çš„ noise åœ¨ createGraphics è£¡æ˜¯ç¨ç«‹çš„å—ï¼Ÿ
                // é€šå¸¸ noiseSeed æ˜¯å…¨åŸŸçš„ï¼Œæ‰€ä»¥æ‡‰è©²æ²’å•é¡Œã€‚
                
                for (let y = 0; y < h; y++) {
                    for (let x = 0; x < w; x++) {
                        // æ³¨æ„ï¼šå› ç‚ºè§£æåº¦è®Šäº†ï¼Œ"scale" çš„è¦–è¦ºæ•ˆæœä¹Ÿæœƒè®Š
                        // å¦‚æœæƒ³ä¿æŒåœ–æ¡ˆæ¯”ä¾‹ä¸€è‡´ï¼Œéœ€è¦æ ¹æ“šå¯¬åº¦æ¯”ä¾‹èª¿æ•´ scale?
                        // é€šå¸¸ scale æ˜¯åŸºæ–¼åæ¨™çš„ã€‚å¦‚æœ canvas è®Šå¤§ï¼Œæˆ‘å€‘å¸Œæœ›çœ‹åˆ°"æ›´å¤š"åœ°å½¢ï¼Œé‚„æ˜¯"æ”¾å¤§"åœ°å½¢ï¼Ÿ
                        // æŸæ—å™ªè²é€šå¸¸æ˜¯åŸºæ–¼åæ¨™ç©ºé–“ã€‚å¦‚æœ w è®Šå¤§ï¼Œæˆ‘å€‘æœƒçœ‹åˆ°å³é‚Šæ›´å¤šçš„åœ°å½¢ã€‚
                        // å¦‚æœå¸Œæœ›ä¿æŒè¦–è¦ºæ¯”ä¾‹ï¼ˆZoomï¼‰ï¼Œéœ€è¦èª¿æ•´è¼¸å…¥çš„ x, yã€‚
                        // é€™è£¡æˆ‘å€‘æ¡ç”¨æ¨™æº–åšæ³•ï¼šç•«å¸ƒè®Šå¤§ = è¦–é‡è®Šå¤§ã€‚
                        
                        let noiseVal = fractalNoise(x, y, params.timeOffset, params.scale, params.octaves, params.persistence, params.lacunarity);
                        
                        if (params.stepping) {
                            noiseVal = Math.floor(noiseVal * params.stepCount) / (params.stepCount - 1);
                            noiseVal = Math.min(noiseVal, 1);
                        }

                        let c = getThemeColor(noiseVal, params.theme);
                        
                        // Graphics Buffer çš„ set æ“ä½œæ¯”è¼ƒæ…¢ï¼Œç›´æ¥æ“ä½œ pixels é™£åˆ—
                        let index = (x + y * w) * 4;
                        pg.pixels[index] = red(c);
                        pg.pixels[index+1] = green(c);
                        pg.pixels[index+2] = blue(c);
                        pg.pixels[index+3] = 255;
                    }
                }
                
                pg.updatePixels();
                
                // ä¸‹è¼‰
                let filename = `noise_seed${params.seed}_${params.theme}`;
                save(pg, filename, fmt);
                
                // æ¸…ç†
                pg.remove();
                
                // éš±è— Loading
                loading.style.display = 'none';
            }, 100);
        }

        // p5 map å‡½æ•¸è¦†è“‹ (é˜²æ­¢è¡çª)
        // p5 è‡ªå¸¶ map, lerpColor, noise, noiseSeed, etc.
    </script>
</body>
</html>
